\section{Архитектура}

\subsection{Описание архитектуры}

Для выполнения поставленных целей было решено использовать клиент-серверную
архитектуру. В роли клиента выступает web-приложение, предоставляющее
пользователю необходимый интерфейс для взаимодействия, а серверная часть
отвечает за конвертацию OBJ-файлов и выполнение серверных вычислений. Обе части
взаимодействуют между собой по средствам технологии AJAX и специально
разработанного для целей приложения протокола, основанного на сообщениях в
формате JSON особого вида. Таким образом взаимодействие между компонентами системы
происходит по средствам внешнего API, предоставленного серверной частью,
что соответствует принципу инкапсуляции и способствует заменяемости
любого из компонентов архитектуры.

\subsubsection{Клиент}

Клиентская часть была реализована в виде web-приложения, написанного
на HTML5.0 и Javascript. Для отображения графики используется
перспективная технология WebGL.

WebGL\cite{webgl} - это библиотека для программного обеспечения, которая расширяет
возможности языка программирования JavaScript, позволяя ему создавать
интерактивную 3D графику внутри любого совместимого с ней web-браузера. Код на
WebGL выполняется с помощью вычислительных ресурсов видеокарты. Технология
разрабатывается промышленным консорциумом Khronos Group, который
специализируется на выработке открытых стандартов интерфейсов программирования в
области создания и воспроизведения динамической графики и звука. Активное
участие в разработке и внедрении стандарта так же принимают разработчики
браузеров Apple Safari, Google Chrome, Mozilla Firefox, Opera,  а также
специалисты компаний AMD и NVidia. На данный момент технология поддерживается в
последних версиях браузеров Safari, Mozilla, Opera и Chrome, а так же в браузере
Internet Explorer при использовании специального дополнения IEWebGL. Среди
мобильных устройств данная технология уже поддерживается в браузере телефона
Nokia N900, а так же в Safari Mobile начиная с версии операционной системы iOS
4.2.

Выбор технологии WebGL в качестве средства для отображения трехмерной графики
преследует цель достижения кросс-платформенной реализации. Перспективы развития
этой технологии в отношении рынка мобильных платформ являются самыми
многообещающими по сравнению с остальными кросс-платформенными технологиями.
\footnote{стоит отметить, что использование WebGL разрешено в браузере Mobile
Safari только в контексте рекламных объявлений iAd}

\subsubsection{Сервер}

Cервеная часть была реализована с использованием технологии с открытым исходным
кодом``Node.js''. Эта технология позволяет исполнять JavaScript на стороне
сервера, причем в качестве виртуальной машины для исполнения JavaScript-кода
используется высокопроизводительная V8, разработанная компанией Google и
используемая в браузере Google Chrome.

``Node.js''\cite{nodejs} - платформа с открытым исходным кодом для построения приложений,
основанных на асинхронных I/O операциях с использованием языка JavaScript.
Несмотря на распространенное мнение, платформа не является первой в своем роде и
в некотором роде наследует принципы, заложенные в асинхронном I/O фреймворке
``EventMachine'' для языка программирования Ruby. Однако большим достоинством
этой платформы перед ``EventMachine'' можно назвать язык программирования
EcmaScript стандарта 5.0, или JavaScript, применяемый на платформе ``Node.js'' и
исторически ориентированный на асинхронные взаимодействия.  Благодаря отсутствию
в его спецификации I/O операций (что в некотором смысле удивительно для
web-ориентированного языка), появилась возможность создать необходимую
библиотеку асинхронных I/O операций, которая и стала стандартной при
использовании ``Node.js''-приложений.

Использование одного и того же языка на стороне клиента и сервера дает несколько
достоинств разработчикам. В первую очередь появляется возможность эффективного
переиспользования одного и того же кода как на клиентской, так и на серверной
частях приложения. Примером такого переиспользования может служить
код проверки данных формы, который из соображений безопасности и целостности
обязан присутствовать на стороне сервера, а из соображений удобства пользования
интерфейсом и минимизации клиент-серверных взаимодействий должен быть также и на
клиентской стороне.

Интересной особенностью технологии ``Node.js'', используемой в качестве серверной
платформы, можно назвать высокую производительность и чрезвычайно легкую
масштабируемость. Эти особенности связаны с асинхронной моделью чтения и записи
данных. Таким образом, в противоположность классическому web-серверу,
запускающему обработку каждого запроса в отдельном потоке, но выполняющем в этом
потоке синхронные операции, ``Node.js'' использует только один системный поток.
В случае необходимости масштабирования ``Node.js'' серверов, можно запустить
несколько серверов приложения, объединив их по средством обратного proxy с
балансером. Таким образом приложение, разработанное на этой платформе,
фактически не имеет потолка по обрабатываемой нагрузке.

За время своего существования серверная платформа ``Node.js'' обросла большой
инфраструктурой. Благодаря наличию фреймворка Connect, ставшего стандартом
де-факто для приложений и задавшего стандарт для разработки сторонних модулей,
разработчикам доступно большое количество модулей. Менеджер пакетов обеспечивает
централизованный доступ и быструю установку сторонних модулей, становится
возможным быстрое прототипирование как самого приложения, так и его отдельных
возможностей.

Несмотря на то, что преимущества от использования динамического
слабо-типизированного прототипно-ориентированного языка на стороне сервера
заметны далеко не сразу, ввиду выше указанных причин является
обоснованным и оправданным.

\subsubsection{Переиспользование унаследованного кода}

Для поддержания возможности переиспользования модулей и алгоритмов, написанных
на языке программирования С++ для ранее разработанных desktop-приложений,
используется технология Apache Thrift.

Эта технология была разработана в Facebook по аналогии с Google Protocol Buffers
и служит для написания приложений на нескольких языках программирования. Thrift
представляет собой транскомпилятор, преобразующий файл описания данных и
сигнатуры методов, предназначенных для удаленного вызова, на любой из
поддерживаемых языков\footnote{Thrift версии 0.8.0 поддерживает 20 языков}.

С помощью этой технологии серверная часть приложения получила возможность
вызывать методы, написанные на языках программирования, отличных от JavaScript.
Однако так как вся информация о состоянии геометрии находится на клиенте, то
отдельно было реализовано дополнительное клиент-серверное взаимодействие,
передающее текущую информацию о геометрии с клиента на сервер. Таким образом,
была реализована следующая схема

\begin{enumerate}
    \item Данные о состоянии геометрии на клиенте кодируются в соответствии с
    установленным форматом клиент-серверного взаимодействия и по протоколу HTTP
    передаются на сервер
    \item Сервер получает состояние геометрии и передает ее в качестве аргумента
    при вызове удаленного метода, в нашем случае реализованного на языке C++.
    За вызов удаленного метода отвечает технология Thrift
    \item Результаты работы метода возвращаются на сервер. Полученный ответ
    кодируется в соответствии с форматом клиент-серверного взаимодействия и по
    протоколу HTTP отправляются обратно на клиент.
    \item Клиент, получив ответ, применяет новую геометрию к объекту.
\end{enumerate}


\subsection{Альтернативы}

В процессе выбора технологий для решения поставленных задач было
рассмотрено множество альтернативных решений для каждого из участков
архитектуры. Каждое из таких решений было оценено в соответствии с
поставленной задачей и предъявляемыми к ней требованиями. Результаты
этого исследования определили выбор в пользу описанных технологий. Ниже
приведены решения и подходы, рассмотренные в качестве альтернатив для
реализации поставленных задач, и дан их краткий анализ.

\subsubsection{Flash на стороне пользователя}

При разработке интерактивных web-приложений большую популярность снискала
технология Flash, позволяющая создавать графически богатые интерфейсы. Для
работы этой технологии в браузере необходимо специальное дополнение,
устанавливающееся пользователем отдельно. За счет
своей распространенности технология обладает обширным сообществом, большим
количеством учебных материалов и многочисленными движками для обработки и
отображения трехмерной графики.

Несмотря на вышеперечисленные достоинства, технология Flash на данных момент не
поддерживается ни на одной из популярных мобильных платформ. Компания Adobe,
владеющая всеми правами на технологию Flash и являющаяся единственным ее
разработчиком, официально отказалась от развития мобильного направления развития
платформы. В задачи данной работы входило создание кросс-платформенного
приложения, в том числе способного выполняться на планшетных компьютерах. Ввиду
отсутствия такой теоретической возможности, от этой технологии было решено
отказаться.

\subsubsection{Использование 3D-фреймворка Unity}

Платформа Unity зарекомендовала себя в качестве мощного средства создания
двумерных и трехмерных приложений под консоли и настольные компьютеры под
управлением OS X и Windows. Кроме того, платформа занимает свою нишу в области
web-приложений, предоставляя разработчикам разрабатывать браузерные игры на
Unity и использованием одной из следующих опций

\begin{itemize}
    \item Использование специального дополнения для браузера, исполняющего код
    Unity-приложений. Это дополнение должно быть установлено пользователем.
    \item Использование экспериментального движка на основе Flash. У
    пользователя должно быть установлено дополнение, позволяющее исполнять код
    технологии Flash.
\end{itemize}

К сожалению, ни одна из предложенных опций не поддерживается на мобильных
системах. Однако, благодаря кросс-платформенной сущности движка, существует
возможность перекомпилировать приложения, написанные с использованием этой
технологии, под целевые платформы. Такое решение позволяет покрыть мобильный
сегмент, однако не соответствует модели распространения SAAS, из-за чего от
технологии было решено отказаться.

\subsubsection{Использование Ruby on Rails}

Ввиду поставленных задач возникла необходимость использования серверной части в
архитектуре приложения. При разработке любого серверного решения
акценты ставятся на вопросы масштабирования, а так же возможности быстрого
прототипирования приложения. Используемый фреймворк должен
поддерживать роутинг запросов соответствующим обработчикам и поддерживать
шаблоны для генерации html-страниц. Этим параметрам удовлетворяют
несколько популярных серверных решений: фреймворк ``Ruby on Rails'', фреймворк
``Django'' и платформа ``Node.js'' с серверным фреймворком
``Express.js''\cite{expressjs}. Ввиду
концептуальной схожести фреймворков ``Ruby on Rails'' и ``Django'' ограничимся сравнением Ruby on Rails и ``Node.js''.


``Ruby on Rails'' является более солидным и развитым проектом, нежели
``Express.js''. Обе платформы предлагают менеджеры пакетов и большую библиотеку
общедоступных open-source решений для самых разных задач, что делает
прототипирование одинаково легким на обоих платформах. Однако использование
``Ruby on Rails'' налагает на разработчика необходимость конвертации объектов из
одного языка в другой при клиент-серверных взаимодействиях, а так же заставляет
отказаться от потенциальной возможности переиспользовать некоторые участки кода
на стороне сервера, написанные для исполнения на стороне клиента. Кроме того,
``Node.js'' приложения легче масштабируются.

Ввиду всего вышесказанного было решено использовать  на
стороне сервера

\subsubsection{Protocol Buffers вместо Apache Thrift}

Для создания приложений с использованием нескольких языков встает проблема
взаимодействия модулей. Традиционным решением является абстракция удаленного
вызова процедур, когда один модуль по средствам заданного протокола кодирует
данные и по средствам транспорта передает их процедуре другого модуля на
обработку. Ответ этой процедуры
кодируется с использованием того же протокола и отправляется вызывавшему.

В описанном выше взаимодействии важную роль играют процессы сериализации и
десериализации
объектов, а так же поддержание согласованности программного кода для выполнения
этих задач на каждом из языков программирования. Для решения этих задач широко
применяется одна из следующих технологий:

\begin{itemize}
    \item Google Protocol Buffers
    \item Apache Thrift
\end{itemize}

Технология Apache Thrift является последователем Google
Protocol Buffers и разработана в свете опыта использованяи последней. Сравнение
двух технологий удобно отображать в виде таблицы.

\begin{center}
\scalebox{0.7}{%
    \begin{tabular}{ | c | c | c |}
    \hline
    & \textbf{Apache Thrift} & \textbf{Google Protocol
    Buffers} \\ \hline
    \textbf{Форматы} & Binary, JSON & Binary \\ \hline
    \textbf{Поддержка ``Node.js''} & Включена в официальную поставку & В виде сторонних
    библиотек \\ \hline
    \textbf{Транспортный уровень} & Включен в официальную поставку & В виде сторонних
    библиотек \\ \hline
    \textbf{Документация} & Посредственная & Очень хорошая \\
    \hline
    \end{tabular}
}
\end{center}

Дополнительно стоит отметить, что быстродействие обоих фреймворков примерно
одинаково, поэтому по совокупности признаков, описанных в таблице, выбор был
сделан в пользу Apache Thrift как наиболее подходящей для поставленных целей и
используемых технологий.
